## 性能优化清单

### 使用 **CDN** 加速静态资源访问



### 缓存

- 强缓存

  > 当在 HTTP 头部设置了 `Cache-Control: max-age=xxx` 时，代表使用了强缓存；浏览器会使用本地缓存除非缓存过期；

- 协商缓存

  > 浏览器会向服务器询问缓存是否可以，返回 304 代表可继续使用，200 代表使用最新的。



### 减少 HTTP 请求

- CSS/JS 合并打包
- 雪碧图
- 小图片使用 base64格式或者 iconfont



### 减少静态资源大小

- 压缩 CSS/JS 代码

  > 一般使用 gulp, webpack, rollup, parcel 等构件根据直接压缩

- 压缩图片大小

  > 可以使用在线工具：[tinypng](<https://tinypng.com/>)

- 保持代码的精简高效

  > 优化你的 HTML 代码，减少不必要的元素和嵌套

- 服务端开启 gzip 或者 deflate 压缩



### 减少 DNS 查询时间

> 尽量减少页面上需要 DNS 查询的域名数量，保持和并行下载数一致即可；
>
> 也可通过 dns-prefetch 开启 **DNS 预查询**
>
> ```html
> <link rel="dns-prefetch" href="//google.com" />
> ```



### 使用 HTTP/2.0

优点：

- 多路请求复用 CTP 连接
- 头部压缩



### 避免重定向



### 尽量减少使用 iframe

> 优点：
>
> - 可以用来加载速度较慢的第三方资源，如广告、徽章；
> - 可用作[安全沙箱](http://www.html5rocks.com/en/tutorials/security/sandboxed-iframes/)；
> - 可以并行下载脚本。
>
> 缺点：
>
> - 加载代价昂贵，即使是空的页面；
>
> - 阻塞页面 `load` 事件触发；
>
>   > iframe 完全加载以后，父页面才会触发 `load` 事件。 Safari、Chrome 中通过 JavaScript 动态设置 iframe `src` 可以避免这个问题。
>
> - 缺乏语义。



### 避免内存溢出



### 懒执行

懒执行就是将某些逻辑延迟到使用时再计算。该技术可以用于首屏优化，对于某些耗时逻辑并不需要在首屏就使用的，就可以使用懒执行。懒执行需要唤醒，一般可以通过定时器或者事件的调用来唤醒。



### 懒加载

懒加载就是将不关键的资源延后加载。

懒加载的原理就是只加载自定义区域（通常是可视区域，但也可以是即将进入可视区域）内需要加载的东西。对于图片来说，先设置图片标签的 `src` 属性为一张占位图，将真实的图片资源放入一个自定义属性中，当进入自定义区域时，就将自定义属性替换为 `src` 属性，这样图片就会去下载资源，实现了图片懒加载。



### 预加载

在开发中，可能会遇到这样的情况。有些资源不需要马上用到，但是希望尽早获取，这时候就可以使用预加载。

预加载其实是声明式的 `fetch` ，强制浏览器请求资源，并且不会阻塞 `onload` 事件，可以使用以下代码开启预加载

```html
<link rel="preload" href="http://example.com" />
```

预加载可以一定程度上降低首屏的加载时间，因为可以将一些不影响首屏但重要的文件延后加载，唯一缺点就是兼容性不好。



### 预渲染

可以通过预渲染将下载的文件预先在后台渲染，可以使用以下代码开启预渲染

```html
<link rel="prerender" href="http://example.com" />
```

预渲染虽然可以提高页面的加载速度，但是要确保该页面百分百会被用户在之后打开，否则就白白浪费资源去渲染



### 尽可能使用语义化的标签



### 为图片提供 alt 属性



### 为不同类别的内容提供不同的域名

> 由于浏览器对一个域名有并行线程的限制（一般是 6 个），增加域名数量显然能增加并行线程的数量；
>
> 但是，尽量控制在 2-4 个域名左右，避免 DNS 查询过慢；
>
> 例如，动态内容一个域名，静态内容一个域名，这样还可以禁用静态资源域下的 Cookie，减少数据传输



### 减少 cookie 大小

> 由于 HTTP 机制，每一次的 HTTP 请求都会把当前页面的 cookie 携带发送给服务器，如果 cookie 过大，会影响传输的性能；因此需要对此进行优化：
>
> - 去除不必要的 cookie
> - 为 cookie 设置域名，只在需要的域名设置对应的 cookie
> - 设置恰当的过期时间
> - 静态域名一般无需设置 cookie



### 资源位置

- 把样式表放在 `<head>` 之间，使得页面能尽早按照正确的样式展现，用户体验更好

- 把脚本放在页面底部，因为脚本加载会阻塞 DOM 的渲染

  > 可以使用 async 和 defer 解决此问题



### 其他优化

- 减少 DOM 操作次数

  > DOM 结构的改变会导致页面回流和重绘

- 使用**防抖**和**节流**函数避免高频率操作导致卡顿



## 参考

[1] [前端性能优化的常用手段](<https://juejin.im/post/59672fbff265da6c3f70cd53>)

[2] [前端性能优化最佳实践](<https://csspod.com/frontend-performance-best-practices/>)