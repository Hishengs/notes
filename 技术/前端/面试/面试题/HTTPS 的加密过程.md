# 什么是 HTTPS

HTTPS（全称：Hyper Text Transfer Protocol over Secure Socket Layer），是以安全为目标的 HTTP 通道，简单讲是 HTTP 的安全版。即 HTTP 下加入 SSL 层，HTTPS 的安全基础是 SSL，因此加密的详细内容就需要 SSL。 现在它被广泛用于万维网上安全敏感的通讯，例如交易支付方面。



# HTTP 与 HTTPS 的区别

- HTTP 是明文传输，HTTPS 通过 SSL\TLS 进行了加密

  > TLS 是基于 SSL 的升级版

- HTTP 的端口号是 80，HTTPS 是 443

- HTTPS 需要到 CA 申请证书，一般免费证书很少，需要交费

- HTTP 的连接很简单，是无状态的；HTTPS 协议是由 SSL+HTTP 协议构建的可进行加密传输、身份认证的网络协议，比 HTTP 协议安全。



# 为什么要使用 HTTPS

使用 HTTPS 最主要的用处是以下两点：

- 建立一个信息安全通道，来保证数据传输的安全
- 确认网站的真实性，防止钓鱼网站



# HTTPS 原理

由于 HTTP 是明文传输，A 和 B 两个人进行通讯，消息是无加密的，只要任何人截获到了他们的消息，即可获知其通信内容，在普通场景下这是没什么问题的，即使看到了也无关紧要，但在比较敏感的场景下，例如金融，支付，私密聊天等就要求通信内容不可截获，即使截获了也无法破解。



### 双向对称加密

很自然的，第一个想法是对双方的消息进行加密，双方约定一个密钥，每次发送消息之前先对消息进行加密，对方接受到消息后再用相同的密钥进行解密。

但这带来了一个问题，密钥在双方之间怎么传输？



### 非对称加密

非对称加密存在两个密钥，一个公钥，一个私钥，通常发送方使用接收方的公钥对消息进行加密，接收方在接收到消息之后再使用自己的私钥进行解密；

因此，非对称加密比较适合加密通讯场景，但依然存在一个问题：

接收方在告知发送方公钥时，公钥仍然存在被中间人篡改的可能：

- A 通过网络将公钥 P1 传输给 B
- 中间人截获了此消息，保存 P1，将公钥改为自己的公钥 P2，发送给 B
- B 不知道消息被篡改，以为 P2 就是 A 告知自己的公钥，因此使用其对消息加密，发送给 A
- 消息被中间人截获，中间人使用自己的私钥 S2 对消息进行解密，获知了通信内容，并将加密的消息转发给 A

另外，相对于对称加密，非对称加密的效率太低了。



### 对称加密 + 非对称加密

两种加密方式都存在各自的问题，那么可以将二者结合起来：

- A 使用非对称加密（B 的公钥）对 对称加密的密钥（二者协商的密钥） 进行加密，发送给 B
- B 使用自己非对称加密的私钥对消息进行解密，拿出对称加密的私钥
- 之后 A 和 B 的通信直接使用对称加密进行加密传输

上面仍然存在着公钥被中间人截获的风险，那么如何解决这个问题呢？



### 数字证书

数字证书的诞生正是为了处理公钥有效性的问题。

既然接收方无法确认对方的公钥是否就是他本人的公钥，那么可以拿到“公证处”进行公证，以确定这个公钥的合法性。这个“公证处”就是 CA 中心，即证书颁发机构。

#### CA 认证过程

- A 将自己的 **公钥 + 个人信息 + 其他信息**，通过 hash 算法，生成一个**摘要**；
- CA 中心使用自己的私钥对**摘要**进行加密，得到**数字签名**；
- CA 中心使用 A 的 **（公钥 + 个人信息 + 其他信息）** + **数字签名** 制作成一个**数字证书**颁发给 A
- A 和 B 通信时会把自己的证书发送给 B，B 拿到证书后使用相同的 hash 算法对 A 的 **公钥 + 个人信息 + 其他信息** 生成**摘要1**；然后使用 CA 中心的公钥对数字签名进行解密得到**摘要2**；接着将两个摘要进行对比，看是否一致，如果一致，说明此证书可信。



## 参考

[1] [JWT、OAuth 2.0、session 用户授权实战](<https://juejin.im/post/5cddae69f265da036207d036#heading-8>)

[2] [一个故事讲完https](<https://mp.weixin.qq.com/s/StqqafHePlBkWAPQZg3NrA>)

[3] [谈谈 HTTPS](<https://juejin.im/post/59e4c02151882578d02f4aca>)

