## JavaScript 的内存回收机制

主要有两种：标记清除法和引用计数法。



### 标记清除法

**这是 javascript中 最常用的垃圾回收方式**

![img](https://user-gold-cdn.xitu.io/2019/4/20/16a39f9f108cfc79?imageslim)



### 引用计数法

引用计数的原理是：对一块内存，如果有一个变量引用了它，其被引用数就为 1，如果有多个变量引用了它，其被引用数依次递增；当一块内存的被引用数为 0 时，代表此内存可被回收。

然后，引用计数有一个问题：

```js
function func() {
    let obj1 = {};
    let obj2 = {};

    obj1.a = obj2; // obj1 引用 obj2
    obj2.a = obj1; // obj2 引用 obj1
}
```

在上述函数执行完之后，内部所有的变量都应该被回收，然而因为循环引用的原因，两个对象的引用计数都为 1，导致没有被回收。



## 内存泄漏常见情况

### 意外的全局变量

```js
function test () {
    foo = 'Hisheng';
}
```

如上，foo 未使用 var 进行定义，默认成了全局变量，这并不是期望的结果，导致该变量所使用的内存在页面关闭之前都不会被回收。

### 被遗忘的计时器或回调函数

### 闭包

### 没有清理的DOM元素引用



## 参考

[1] [JavaScirpt 中的垃圾回收和内存泄漏](<https://juejin.im/post/5cb33660e51d456e811d2687>)