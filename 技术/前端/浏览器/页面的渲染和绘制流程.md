# 页面的渲染和绘制流程

当浏览器渲染进程接收到一个页面的 html 字符串时，便开始了页面的渲染和绘制，主要经历以下几个过程

html string => dom + style => 布局树 layout tree => layer tree => 图层绘制 paint => 栅格化（raster） => 合成 composite => 显示

## 输入 URL

再早一点，我们从输入 URL 开始

- 浏览器识别输入的是 URL 还是搜索关键词，如果是后者则转化为对应搜索引擎的搜索 URL
- 将 URL 交给 `网络请求进程` 处理，如果存在页面缓存则返回
- 通过 URL 进行 DNS 查询，先查询 浏览器 DNS 缓存 => 系统 DNS 缓存 => 服务运营商 DNS 缓存 => 上级服务运营商 DNS 缓存 ...
- 得到目标 IP 再将请求交给底层协议转发
- 再经 IP => TCP => HTTP 得到请求页面资源，由于我们是请求一个网页，得到的就是它的 html
- 将 html 交给 `渲染进程` 处理


## 渲染进程得到 html 后

**构造 DOM 树**

`渲染进程` 得到 html 后，会开始对 html 进行解析，parse 成一颗 dom 树，类似 AST 的结构
 
在 parse 过程中，会先预解析 html 中存在的静态资源，并交给 `网络请求进程` 提前进行下载
 
在解析 html 字符串过程中，匹配到元素标签，则生成对于的标签节点到 dom 树，如果遇到 `<script>` 标签，则会暂停解析和 dom 树的构造，先请求脚本或者执行脚本后，再继续进行
 
> 因为某些脚本操作会影响 dom 树的结构，譬如 `document.write`

**样式合并与计算**

合并 **浏览器默认样式** + **`<link>` 的样式** + **`<style> `样式** + **元素行内样式**，然后标准化样式（例如将 em, rem, % 等转换为绝对值 px），计算出每个元素的最终样式（computed style）

**布局树**

TODO
